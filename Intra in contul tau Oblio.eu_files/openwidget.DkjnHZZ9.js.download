import{c as e,t,i as n}from"./1.6psiIc4J.chunk.js";import{_ as i,n as a,f as o,t as s,a as r,b as l,m as d}from"./3.DiEu57nc.chunk.js";import{e as c,c as p,u,a as g,p as m,f as h,m as f,C as b,S as v,B as w,R as S,b as _,i as I,d as E,g as A,h as C,j as k,k as y,l as z,n as O,o as T,q as N,M as P,r as j,s as V,t as M,v as x,w as L,x as D}from"./5.Czyav0-3.chunk.js";import"./6.B0_QvnEW.chunk.js";import{u as R,s as U,i as q}from"./15.Ds1NXQbV.chunk.js";import{f as B,p as F,_ as H,d as W,s as G}from"./2.DNGoWbi7.chunk.js";import{i as J}from"./12.DJPUQwQu.chunk.js";import"./11.al-9NYxR.chunk.js";import"./4.C_rgEAoe.chunk.js";const Q=(e,t)=>{if(void 0===e)return null;const n=e.find(e=>e.name===t);return n||null},X=(e,t)=>{t.forEach(t=>c(e,p(t.name),t))};const K=(e,t)=>"@@ow_session_started:"+e+":"+t,Y={lc:()=>H(()=>import("./0.DIaqU0KN.chunk.js"),[]),openai:()=>H(()=>import("./13.m6n1UMuz.chunk.js"),[]),chatbot:()=>H(()=>import("./14.C4Wg4fNW.chunk.js"),[])},Z=new Set,$=(e,t)=>{let{adapterOptions:n,store:i,serverConfig:a}=t;if(Z.has(e))return Promise.resolve();return F(Y[e]).then(t=>{Z.add(e),t.default(n,i,a)})};function ee(e,t,n,a,o){let{licenseId:s}=o;const r=e.getCurrentView(),{url:l}=e.getApplicationState("page");let d=null;return C({licenseId:s}).then(o=>{var r,c;return k({url:l,region:o,licenseId:s,productName:null==(r=a.model)?void 0:r.productName,integrationName:null==(c=a.model)?void 0:c.integrationName},{validateDefaultWidget:!1}).then(e=>Promise.all([y({organizationId:e.organizationId,groupId:e.groupId,version:e.configVersion,region:e.region}),z({language:e.language,groupId:e.groupId,organizationId:n.organizationId,version:e.localizationVersion,region:e.region})]).then(t=>{let[n,i]=t;return[e,n,i]})).then(o=>{let[r,l,c]=o;return d=c,$("lc",{store:e,adapterOptions:i({},a,{identityProvider:t.getAuth,region:r.region}),serverConfig:W(l,{dynamicConfig:r,__unsafeProperties:{group:T(["chatBoosters","language","linksUnfurlingEnabled","offlineMessagesEnabled","prechatFormAfterGreetingEnabled","ratingEnabled","transcriptButtonEnabled","logo","hasAgentAvatarsEnabled"],n.__unsafeProperties.group)},properties:{group:{[O()]:{homescreen_enabled:!n.isChatOnlyModeEnabled}}}})}).then(()=>{e.setApplicationState({license:s,group:r.groupId}),d?e.setLocalization(W(n.localization,d)):e.setLocalization(n.localization)})})}).catch(t=>{"LICENSE_EXPIRED"===t.code&&"DOMAIN_NOT_ALLOWED"===t.code||console.error(t),e.setCurrentView(null!=r?r:"Homescreen"),e.setLocalization(n.localization),N(e,"livechatIntegration",void 0)})}const te=e=>{return window.addEventListener("pagehide",t=>{var n;t.persisted||(n=e.call,"fetch"in window!=0&&n("/v1.0/session/close","POST",{},{keepalive:!0}))}),(t=e.call,t("/v1.0/session/open","POST",{}).then(e=>{if("number"!=typeof e.sessions)throw new Error("Token sessions is undefined");return{sessions:e.sessions}})).catch(()=>null);var t},ne=["livechat_integration","openai_integration","chatbot_integration"];n((n,c,p)=>{const C=function(e){const{isChatOnlyModeEnabled:t}=e;return t?i({},e,{apps:[],features:e.features.filter(e=>ne.includes(e.name))}):e}(p);c.setApplicationState({defaultWidget:"openwidget",owApiURL:"https://api.openwidget.com"});const k=((t,n)=>{const o=e({organizationId:t,uniqueGroups:!1,clientId:String("8c7275c9fa6f4853e8442df1387f7fe6"),tokenStoragePrefix:"@@ow_auth_token:"}),s=(e,t,n)=>{let i="https://api.openwidget.com"+e;return n!==t&&Number.isNaN(Number(n))&&(i=g(i,{tid:String(n)})),i};return{getAuth:()=>o,call:(e,r,l,d)=>{const c=d?window.fetch:u,p=s(e,t,n);return o.getToken().then(e=>{let{accessToken:t}=e;return c(p,i({method:r},c===window.fetch&&{options:d},{headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}},l&&{body:JSON.stringify(l)})).then(e=>e.json().catch(a).finally(t=>e.ok?t:Promise.reject(null!=t?t:{statusCode:e.status})))})},stream:e=>{const i=s(e,t,n);return o.getToken().then(e=>{let{accessToken:t}=e;return window.fetch(i,{method:"GET",headers:{Authorization:"Bearer "+t,Accept:"text/event-stream"}}).then(e=>{const t=e.body,n=null==t?void 0:t.getReader(),i=new TextDecoder;return new ReadableStream({start(e){const t=()=>null==n?void 0:n.read().then(n=>{let{done:a,value:o}=n;if(!a)return i.decode(o,{stream:!0}).split("\n").filter(Boolean).map(e=>e.replace("data: ","").trim()).forEach(t=>{try{const n=JSON.parse(t);e.enqueue(n)}catch(n){}}),t();e.close()});t()}})})})}}})(C.organizationId,C.templateId);V(C,c),N(c,"homeScreen",{enabled:!C.isChatOnlyModeEnabled});const y=Q(C.features,"livechat_integration");null!=y&&y.enabled||function(e){const n=m(l(window,"online"),f(()=>b)),i=m(l(window,"offline"),f(()=>v));m(d(n,i),r(e.setConnectionState)),m(i,r(()=>{e.setApplicationState({disableSendingMessage:!0}),m(d(t(8e3),B(e,w),m(h(e,()=>e.getConnectionState()),o(e=>e!==v))),s(1),r(()=>{e.getConnectionState()!==v?e.setApplicationState({disableSendingMessage:!1}):e.setConnectionState(S)}))})),m(n,r(()=>{e.setApplicationState({disableSendingMessage:!1})})),navigator.onLine&&e.setConnectionState(b)}(c);const z=!((e,t)=>{try{return null!==window.sessionStorage.getItem(K(e,t))}catch(n){return n instanceof Error&&console.error(n),!1}})(C.organizationId,C.templateId);z&&((e,t)=>{try{window.sessionStorage.setItem(K(e,t),Date.now().toString())}catch(n){n instanceof Error&&console.error(n)}})(C.organizationId,C.templateId);const O=Q(C.features,"faq");null!=O&&O.enabled&&c.addView("FAQ"),c.setApplicationState({limits:C.limits,header:C.header}),X(c,C.features),C.isChatOnlyModeEnabled||(c.addView("Contact"),(e=>{const t=e.getApplicationState("header"),{backgroundImage:n,backgroundType:i}=t;"image"===i&&n&&m(h(e,e=>e.application.visibility.state),o(e=>"maximized"===e),s(1),r(()=>{const e=document.createElement("link");e.rel="prefetch",e.as="image",e.href=n,document.head.appendChild(e)}))})(c),c.addView("Homescreen",{apps:C.apps,channels:[]})),G(c,k),M(c);const T=Q(C.features,"visitor_counter"),F=Q(C.features,"product_recommendations"),H=Q(C.features,"google_reviews"),W=Q(C.features,"whatsapp"),Y=Q(C.features,"messenger"),Z=Q(C.features,"openai_integration"),ie=Q(C.features,"chatbot_integration"),ae=Q(C.features,"forms"),oe=[];if(null!=F&&F.enabled&&x(c,k),null!=ae&&ae.enabled&&L(ae.properties.templates).filter(e=>{let[,t]=e;return t}).forEach(e=>{let[t]=e;c.addView("Form-"+t,{name:t,values:{},isSubmitted:!1,customerEmail:null,submitError:null})}),null!=ie&&ie.enabled){const e=function(e,t,n,i,a,o,s,r){return a?Promise.resolve():(X(e,[{name:"chatbot_integration",enabled:!0,properties:{clientId:t,botName:n,botDescription:i,isExpired:a,avatarUrl:o,showTextField:s,greetings:r}}]),e.on("request_update_user",n=>{let{resolve:i,id:a,data:{properties:o}}=n;e.getSessionUserId()===a&&(R(t,o),i())}),e.on("request_set_user_properties",n=>{let{resolve:i,id:a,properties:o}=n;e.getSessionUserId()===a&&(U(t,o),i())}),$("chatbot",{store:e,adapterOptions:{clientId:t},serverConfig:{}}))}(c,ie.properties.clientId,ie.properties.botName,ie.properties.botDescription,ie.properties.isExpired,ie.properties.avatarUrl,ie.properties.showTextField,ie.properties.greetings);oe.push(e)}else if(null!=y&&y.enabled){const e=ee(c,k,C,n,y.properties);oe.push(e)}else if(null!=Z&&Z.enabled&&null!=Z&&Z.properties.assistantId&&(null==Z||!Z.properties.quotaExceeded)&&(null==Z||!Z.properties.hasInsufficientPermissions)){var se,re;const e=function(e,t,n,i,a,o){return X(e,[{name:"openai_integration",enabled:!0,properties:{assistantId:n,botName:i,welcomeMessage:a,avatarUrl:o}}]),t.getAuth().getToken().then(n=>$("openai",{store:e,adapterOptions:{apiCaller:t,tokenInfo:n},serverConfig:{}}))}(c,k,Z.properties.assistantId,Z.properties.botName,Z.properties.welcomeMessage,null!=(se=null==(re=Z.properties)?void 0:re.avatarUrl)?se:null);e&&oe.push(e)}if((null!=T&&T.enabled?te(k):Promise.resolve(null)).then(e=>{null!=H&&H.enabled&&((e,t)=>{const{googleReviews:n}=e.getApplicationState();n.hidden||t&&(m(h(e,e=>e.application.visibility.state),o(t=>"maximized"===t&&e.getApplicationState("googleReviews")),r(()=>{A(e,{transitionState:"hidden"})})),A(e,{transitionState:"hidden"}),I(e,"minimized")&&E(e,"googleReviews"))})(c,z),null!=T&&T.enabled&&((e,t,n)=>{const{visitorCounter:i}=e.getApplicationState();i.hidden||!t||t.sessions<P||(j(e,{session:t,transitionState:"hidden"}),I(e,"minimized")&&n&&E(e,"visitorCounter"),m(h(e,e=>e.application.visibility.state),o(e=>"maximized"===e),r(()=>{j(e,{transitionState:"hidden"})})))})(c,e,z),(null!=W&&W.enabled||null!=Y&&Y.enabled)&&(e=>{const{contactInvitation:t}=e.getApplicationState();t.hidden||(m(h(e,e=>{e.application.visibility.state}),o(e=>"maximized"===e&&t),r(()=>{_(e,{transitionState:"hidden"})})),_(e,{transitionState:"hidden"}),I(e,"minimized")&&E(e,"contactInvitation"))})(c)}),c.on("send_form",e=>{k.call("/v1.0/product/send_form","POST",e).then(e=>c.emit("send_form_success",e)).catch(e=>c.emit("send_form_error",e))}),!function(e,t,n){return!(e.isChatOnlyModeEnabled||t.getCurrentView()||n.model.initialView&&"Homescreen"!==n.model.initialView)}(C,c,n)?C.isChatOnlyModeEnabled&&c.setCurrentView("Chat"):c.setCurrentView("Homescreen"),C.isChatOnlyModeEnabled){const e=c.getApplicationState("config").features,t=null==y?void 0:y.enabled,i=q(e),a=J(e);var le;if(!t&&!i&&!a)return console.error("[OpenWidget] No chat integration available in chat only mode."),null==(le=n.model)||null==le.hide||le.hide(),void c.setApplicationState({destroyed:!0})}0===oe.length?c.setApplicationState({readyState:D}):Promise.all(oe).then(()=>{c.setApplicationState({readyState:D})})},e=>e.organizationId+":state");
